<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart - Online Garments Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../public/css/index.css" />
    <style>
      .cart-item-image {
        border-radius: 8px;
        object-fit: cover;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container">
        <a class="navbar-brand" href="index.html">Online Garments Store</a>
        <div class="collapse navbar-collapse">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="products.html">Shop</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="categories.html">Categories</a>
            </li>
            <li id="auth-link" class="nav-item"></li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-5">
      <h1 class="mb-4">Shopping Cart</h1>
      <div id="cartContent">
        <p id="cartMessage">Loading cart...</p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const token = localStorage.getItem("token");
        const authLink = document.getElementById("auth-link");

        if (token) {
          authLink.innerHTML = `
            <li class="nav-item" style="display:flex;">
              <a class="nav-link" href="my-account.html">My Account</a>
              <p class="nav-link" style="cursor: pointer;" id="logoutBtn">Logout</p>
            </li>
          `;
        } else {
          authLink.innerHTML = `
            <li class="nav-item" style="display:flex;">
              <a class="nav-link" href="signin.html">Sign In</a>
              <a class="nav-link" href="signup.html">Sign Up</a>
            </li>
          `;
        }
        if (token) {
          const logoutBtn = document.getElementById("logoutBtn");
          logoutBtn.addEventListener("click", () => {
            localStorage.removeItem("token");
            localStorage.removeItem("u2yCwN4hBx");
            sessionStorage.removeItem("token");
            sessionStorage.removeItem("u2yCwN4hBx");
            window.location.href = "../index.html";
          });
        }

        const cartContent = document.getElementById("cartContent");

        const getCart = () => JSON.parse(localStorage.getItem("cart")) || [];
        const saveCart = (cart) =>
          localStorage.setItem("cart", JSON.stringify(cart));

        let cart = getCart();

        if (cart.length === 0) {
          cartContent.innerHTML =
            '<p class="text-info">Your cart is empty.</p>';
          return;
        }

        // Build cart items HTML
        const itemsHtml = cart
          .map(
            (item) => `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center gap-3">
              <img src="${item.image_1}" alt="${item.name}"
                style="width: 80px; height: 80px;" class="cart-item-image" />
              <div>
                <strong>${item.name}</strong><br>
                <small>$${item.price.toFixed(2)}</small><br>
                <div class="mt-2">
                  <label class="me-2">Qty:</label>
                  <input type="number" class="form-control d-inline-block quantity-input"
                    data-id="${item.id}" value="${item.quantity || 1}"
                    min="1" max="5" style="width: 70px;" />
                </div>
              </div>
            </div>
            <button class="btn btn-sm btn-danger remove-item" data-id="${
              item.id
            }">
              Remove
            </button>
          </li>
        `
          )
          .join("");

        // Calculate total
        const total = cart
          .reduce((sum, item) => sum + item.price * (item.quantity || 1), 0)
          .toFixed(2);

        cartContent.innerHTML = `
          <ul class="list-group mb-3">
            ${itemsHtml}
          </ul>

          <div class="card p-3 shadow-sm">
            <h5 class="mb-3">Order Summary</h5>
            <p>Total Items: <strong>${cart.reduce(
              (sum, item) => sum + (item.quantity || 1),
              0
            )}</strong></p>
            <p>Subtotal: <strong>$${total}</strong></p>
            <div class="d-flex flex-wrap gap-2 mt-3">
              <button class="btn btn-primary checkout-btn">Proceed to Checkout</button>
              <button class="btn btn-outline-danger empty-cart-btn">Empty Cart</button>
            </div>
          </div>
        `;

        // Handle quantity changes
        const quantityInputs = document.querySelectorAll(".quantity-input");
        quantityInputs.forEach((input) => {
          input.addEventListener("change", (e) => {
            const newQty = parseInt(e.target.value);
            const id = parseInt(e.target.getAttribute("data-id"));
            if (newQty < 1) {
              e.target.value = 1;
              return;
            }
            if (newQty > 5) {
              e.target.value = 5;
              return;
            }
            cart = cart.map((item) =>
              item.id === id ? { ...item, quantity: newQty } : item
            );
            saveCart(cart);
            location.reload();
          });
        });

        // Handle remove buttons
        const removeButtons = document.querySelectorAll(".remove-item");
        removeButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const idToRemove = parseInt(button.getAttribute("data-id"));
            cart = cart.filter((item) => item.id !== idToRemove);
            saveCart(cart);
            location.reload();
          });
        });

        // Handle empty cart
        const emptyCartBtn = document.querySelector(".empty-cart-btn");
        emptyCartBtn.addEventListener("click", () => {
          if (confirm("Are you sure you want to empty your cart?")) {
            localStorage.removeItem("cart");
            location.reload();
          }
        });

        // Handle checkout button
        const checkoutBtn = document.querySelector(".checkout-btn");
        checkoutBtn.addEventListener("click", () => {
          // Redirect to checkout page if available
          location.href = "checkout.html";
        });
      });
    </script>
  </body>
</html>
