<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details - Online Garments Store</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <style>
      .product-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .product-image:hover {
        transform: scale(1.05);
      }

      .thumbnail-image {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 4px;
        cursor: pointer;
        border: 2px solid transparent;
        transition: border-color 0.3s ease;
      }

      .thumbnail-image:hover,
      .thumbnail-image.active {
        border-color: #0d6efd;
      }

      .price {
        font-size: 2rem;
        font-weight: bold;
        color: #198754;
      }

      .stock-badge {
        font-size: 0.9rem;
      }

      .category-badge {
        background-color: #f8f9fa;
        color: #6c757d;
        border: 1px solid #dee2e6;
      }

      .btn-add-to-cart {
        padding: 12px 30px;
        font-size: 1.1rem;
        font-weight: 500;
      }

      .product-title {
        font-size: 2.5rem;
        font-weight: 300;
        margin-bottom: 1rem;
      }

      .product-description {
        font-size: 1.1rem;
        line-height: 1.7;
        color: #555;
      }

      .loading-spinner {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 400px;
      }

      .error-message {
        text-align: center;
        color: #dc3545;
        font-size: 1.2rem;
        margin-top: 2rem;
      }

      .quantity-input {
        width: 80px;
        text-align: center;
      }

      .product-section {
        margin-bottom: 2rem;
      }
    </style>
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <div class="container-fluid">
        <a class="navbar-brand" href="index.html">Online Garments Store</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
              <a class="nav-link" href="cart.html">
                <i class="bi bi-cart"></i> Cart
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="signin.html">Sign In</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="my-account.html">Profile</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <!-- Loading Spinner -->
      <div id="loadingSpinner" class="loading-spinner">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
      </div>

      <!-- Error Message -->
      <div id="errorMessage" class="error-message d-none">
        <i class="bi bi-exclamation-triangle"></i>
        <p>
          Sorry, we couldn't load the product details. Please try again later.
        </p>
      </div>

      <!-- Product Details -->
      <div id="productDetails" class="d-none">
        <div class="row">
          <!-- Product Images -->
          <div class="col-md-6">
            <div class="product-section">
              <div class="mb-3">
                <img
                  id="mainImage"
                  src=""
                  alt="Product Image"
                  class="product-image"
                />
              </div>
              <div id="thumbnails" class="d-flex gap-2">
                <!-- Thumbnail images will be populated here -->
              </div>
            </div>
          </div>

          <!-- Product Information -->
          <div class="col-md-6">
            <div class="product-section">
              <h1 id="productName" class="product-title"></h1>

              <div class="mb-3">
                <span id="categoryBadge" class="badge category-badge"></span>
              </div>

              <div class="mb-3">
                <span id="productPrice" class="price"></span>
              </div>

              <div class="mb-3">
                <span id="stockBadge" class="badge stock-badge"></span>
              </div>

              <div class="mb-4">
                <h5>Description</h5>
                <p id="productDescription" class="product-description"></p>
              </div>

              <div class="mb-4">
                <div class="row align-items-center">
                  <div class="col-auto">
                    <label for="quantity" class="form-label">Quantity:</label>
                  </div>
                  <div class="col-auto">
                    <input
                      type="number"
                      id="quantity"
                      class="form-control quantity-input"
                      value="1"
                      min="1"
                    />
                  </div>
                </div>
              </div>

              <div class="d-grid gap-2 d-md-flex">
                <button
                  id="addToCartBtn"
                  class="btn btn-primary btn-add-to-cart me-md-2"
                >
                  <i class="bi bi-cart-plus"></i> Add to Cart
                </button>
                <button class="btn btn-outline-secondary">
                  <i class="bi bi-heart"></i> Add to Wishlist
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Get product ID from URL parameters
      function getProductIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id") || window.location.pathname.split("/").pop();
      }

      // Display product details
      function displayProduct(product) {
        document.getElementById("productName").textContent =
          product.name || "Product Name";
        document.getElementById("productDescription").textContent =
          product.description || "No description available";
        document.getElementById("productPrice").textContent = `$${
          product.price || "0.00"
        }`;
        document.getElementById("categoryBadge").textContent =
          product.category.name || "Uncategorized";

        // Set stock badge
        const stockBadge = document.getElementById("stockBadge");
        const stock = product.stock || 0;
        if (stock > 0) {
          stockBadge.textContent = `${stock} in stock`;
          stockBadge.className = "badge bg-success stock-badge";
        } else {
          stockBadge.textContent = "Out of stock";
          stockBadge.className = "badge bg-danger stock-badge";
        }

        // Set up images
        setupProductImages(product);

        // Set up quantity input max value
        document.getElementById("quantity").max = stock;

        // Enable/disable add to cart button based on stock
        const addToCartBtn = document.getElementById("addToCartBtn");
        if (stock <= 0) {
          addToCartBtn.disabled = true;
          addToCartBtn.textContent = "Out of Stock";
        }
      }

      // Setup product images
      function setupProductImages(product) {
        const mainImage = document.getElementById("mainImage");
        const thumbnailsContainer = document.getElementById("thumbnails");

        const images = [
          product.image_1,
          product.image_2,
          product.image_3,
        ].filter((img) => img);

        if (images.length > 0) {
          mainImage.src = images[0];
          mainImage.alt = product.name;

          // Create thumbnails
          images.forEach((image, index) => {
            const thumbnail = document.createElement("img");
            thumbnail.src = image;
            thumbnail.alt = `${product.name} - Image ${index + 1}`;
            thumbnail.className = `thumbnail-image ${
              index === 0 ? "active" : ""
            }`;
            thumbnail.onclick = () => {
              mainImage.src = image;
              // Update active thumbnail
              document.querySelectorAll(".thumbnail-image").forEach((thumb) => {
                thumb.classList.remove("active");
              });
              thumbnail.classList.add("active");
            };
            thumbnailsContainer.appendChild(thumbnail);
          });
        } else {
          // Use placeholder image if no images available
          mainImage.src = "https://via.placeholder.com/400x400?text=No+Image";
          mainImage.alt = "No image available";
        }
      }

      // Add to cart functionality
      function addToCart() {
        const quantity = parseInt(document.getElementById("quantity").value);
        const productId = getProductIdFromUrl();

        // Here you would typically send a request to your cart API
        console.log(`Adding ${quantity} of product ${productId} to cart`);

        // Show success message (you can replace this with a toast notification)
        alert(`Added ${quantity} item(s) to cart!`);
      }

      // Load product details
      async function loadProductDetails() {
        const productId = getProductIdFromUrl();

        if (!productId) {
          showError("Product ID not found in URL");
          return;
        }

        try {
          const response = await fetch(`/api/admin/product/${productId}`);

          if (!response.ok) {
            throw new Error("Failed to fetch product details");
          }

          const product = await response.json();
          console.log(product);
          displayProduct(product.data);

          // Hide loading spinner and show product details
          document.getElementById("loadingSpinner").classList.add("d-none");
          document.getElementById("productDetails").classList.remove("d-none");
        } catch (error) {
          console.error("Error loading product details:", error);
          showError("Failed to load product details");
        }
      }

      // Show error message
      function showError(message) {
        document.getElementById("loadingSpinner").classList.add("d-none");
        document.getElementById("errorMessage").classList.remove("d-none");
        document.getElementById("errorMessage").querySelector("p").textContent =
          message;
      }

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        // Load product details
        loadProductDetails();

        // Add event listener for add to cart button
        document
          .getElementById("addToCartBtn")
          .addEventListener("click", addToCart);
      });
    </script>
  </body>
</html>
